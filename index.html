<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Tools Collection</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f6f7fb;
    }
    header {
      background: #111827;
      color: white;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
    }
    header .actions {
      display: flex;
      gap: 8px;
    }
    button {
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    #exportCsvBtn {
      background: #2563eb;
      color: white;
    }
    #exportCsvBtn:hover {
      background: #1d4ed8;
    }
    main {
      padding: 16px 24px;
    }
    .table-container {
      max-height: 80vh;
      overflow: auto;
      border-radius: 8px;
      background: white;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.12);
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 13px;
    }
    thead {
      position: sticky;
      top: 0;
      background: #f3f4f6;
      z-index: 1;
    }
    th, td {
      border-bottom: 1px solid #e5e7eb;
      padding: 8px 10px;
      text-align: left;
      vertical-align: top;
    }
    th {
      font-weight: 600;
      color: #374151;
    }
    tbody tr:nth-child(even) {
      background: #f9fafb;
    }
    a {
      color: #2563eb;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .small {
      font-size: 12px;
      color: #6b7280;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
    }
    .badge-yes {
      background: #dcfce7;
      color: #166534;
    }
    .badge-no {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <header>
    <h1>AI Tools Collection</h1>
    <div class="actions">
      <button id="exportCsvBtn">Export CSV</button>
    </div>
  </header>
  <main>
    <p class="small">Data source: GitHub 1000 AI tools collection + tool websites.</p>
    <div class="table-container">
      <table id="toolsTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Product</th>
            <th>Company</th>
            <th>Email</th>
            <th>LinkedIn</th>
            <th>Twitter</th>
            <th>Careers Page</th>
            <th>Tool URL</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filled by JS -->
        </tbody>
      </table>
    </div>
  </main>

  <script>
    let toolsData = [];

    async function loadData() {
      try {
        const resp = await fetch("tools_data.json");
        toolsData = await resp.json();
        renderTable(toolsData);
      } catch (e) {
        console.error("Failed to load tools_data.json", e);
      }
    }

    function renderTable(data) {
      const tbody = document.querySelector("#toolsTable tbody");
      tbody.innerHTML = "";

      data.forEach((row, index) => {
        const tr = document.createElement("tr");

        const careersActive = row.careers_page && row.careers_page.trim() !== "";
        const careersBadge = careersActive
          ? `<span class="badge badge-yes">Yes</span>`
          : `<span class="badge badge-no">No</span>`;

        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${escapeHtml(row.product_name || "")}</td>
          <td>${escapeHtml(row.company || "")}</td>
          <td>${escapeHtml(row.email || "")}</td>
          <td>${row.linkedin_url ? `<a href="${row.linkedin_url}" target="_blank">LinkedIn</a>` : ""}</td>
          <td>${row.twitter_url ? `<a href="${row.twitter_url}" target="_blank">Twitter</a>` : ""}</td>
          <td>
            ${careersBadge}
            ${row.careers_page ? `<br><a class="small" href="${row.careers_page}" target="_blank">Open</a>` : ""}
          </td>
          <td>${row.tool_url ? `<a href="${row.tool_url}" target="_blank">Tool Link</a>` : ""}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function exportCsv() {
      if (!toolsData || toolsData.length === 0) {
        alert("No data to export.");
        return;
      }

      const headers = [
        "product_name",
        "company",
        "email",
        "linkedin_url",
        "twitter_url",
        "careers_page",
        "tool_url"
      ];

      const rows = [headers.join(",")];

      toolsData.forEach(row => {
        const csvRow = headers.map(h => {
          const val = row[h] != null ? String(row[h]) : "";
          const escaped = val.replace(/"/g, '""');
          return `"${escaped}"`;
        }).join(",");
        rows.push(csvRow);
      });

      const csvContent = rows.join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);

      const link = document.createElement("a");
      link.href = url;
      link.download = "tools_data_export.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    document.getElementById("exportCsvBtn").addEventListener("click", exportCsv);

    loadData();
  </script>
</body>
</html>